# Create a new payment
Function CreatePayment(orderID, userID):
    If not validPaymentData(orderID, userID):
        Return HTTP 400 Bad Request with message "Invalid payment data"

    paymentID = createPayment(orderID, userID, status = "initiated")
    If paymentID is null:
        Return HTTP 500 Internal Server Error with message "Failed to create payment"

    result = triggerPaymentGateway(paymentID)
    If result is error:
        Return HTTP 500 Internal Server Error with message "Payment gateway initiation failed"

    Return HTTP 201 Created with data: { payment_id: paymentID }






# Get specific payment details
Function GetPaymentByID(paymentID):
    payment = fetchPaymentByID(paymentID)
    If payment not found:
        Return HTTP 404 Not Found with message "Payment not found"

    Return HTTP 200 OK with data: payment






# Retry a failed payment
Function RetryPayment(paymentID):
    payment = fetchPaymentByID(paymentID)
    If payment not found:
        Return HTTP 404 Not Found with message "Payment not found"

    If payment.status != "failed":
        Return HTTP 400 Bad Request with message "Only failed payments can be retried"

    result = triggerPaymentGateway(paymentID)
    If result is error:
        Return HTTP 500 Internal Server Error with message "Retry failed"

    Return HTTP 200 OK with message "Retry initiated"






# Refund a payment
Function RefundPayment(paymentID):
    payment = fetchPaymentByID(paymentID)
    If payment not found:
        Return HTTP 404 Not Found with message "Payment not found"

    If payment.status != "successful":
        Return HTTP 400 Bad Request with message "Only successful payments can be refunded"

    If payment.refundStatus == "refunded":
        Return HTTP 400 Bad Request with message "Payment already refunded"

    result = triggerRefundGateway(paymentID)
    If result is error:
        Return HTTP 500 Internal Server Error with message "Refund failed"

    updateRefundStatus(paymentID, "refunded")

    Return HTTP 200 OK with message "Refund processed successfully"
